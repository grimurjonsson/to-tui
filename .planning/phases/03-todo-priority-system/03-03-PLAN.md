---
phase: 03-todo-priority-system
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/ui/components/todo_list.rs
  - src/ui/theme.rs
autonomous: true

must_haves:
  truths:
    - "P0 todos display with distinct visual indicator (red background)"
    - "P1 todos display with distinct visual indicator (yellow text)"
    - "P2 todos display with distinct visual indicator (blue text)"
    - "No-priority todos display normally (unchanged)"
  artifacts:
    - path: "src/ui/theme.rs"
      provides: "Priority colors in Theme"
      contains: "priority_p0"
    - path: "src/ui/components/todo_list.rs"
      provides: "Priority-aware item rendering"
      contains: "priority"
  key_links:
    - from: "src/ui/components/todo_list.rs"
      to: "src/ui/theme.rs"
      via: "theme.priority_p0, etc."
      pattern: "priority_p"
---

<objective>
Display visual priority indicators in the todo list.

Purpose: Make priority levels immediately visible to users.
Output: Color-coded priority display in TUI.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan for context on Priority enum
@.planning/phases/03-todo-priority-system/03-01-SUMMARY.md

@src/ui/theme.rs
@src/ui/components/todo_list.rs
@src/todo/priority.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add priority colors to Theme</name>
  <files>src/ui/theme.rs</files>
  <action>
Add three new color fields to the Theme struct:
- `priority_p0: Color` - for P0/critical (use red: Color::Rgb(255, 100, 100) or Color::LightRed)
- `priority_p1: Color` - for P1/high (use yellow: Color::Rgb(255, 200, 100) or Color::Yellow)
- `priority_p2: Color` - for P2/medium (use blue: Color::Rgb(100, 150, 255) or Color::LightBlue)

Update the default Theme implementation to set these colors.
Keep the colors visible but not too harsh on dark terminals.
  </action>
  <verify>cargo build --lib passes</verify>
  <done>Theme has priority_p0, priority_p1, priority_p2 color fields</done>
</task>

<task type="auto">
  <name>Task 2: Update todo list rendering for priority display</name>
  <files>src/ui/components/todo_list.rs</files>
  <action>
Modify the rendering to show priority visually. Two approaches to consider:

**Option A - Priority badge before checkbox:**
Display "[P0]" or "[P1]" or "[P2]" badge before the checkbox for items with priority.
Format: `{indent}{fold_icon}[P0] [x] Task content`

**Option B - Color the entire line based on priority:**
Apply priority color as foreground to the entire todo line.

Recommended: Use Option A with colored badge for clearer visibility without changing existing item colors (which indicate state like checked/question).

Implementation:
1. Import Priority from crate::todo::Priority
2. In the render loop, after computing indent/fold_icon:
   - Check item.priority
   - If Some(priority), create priority badge span with appropriate color
   - Add badge span before checkbox span
3. Use theme.priority_p0/p1/p2 for badge colors

The badge should be a Span with the priority text and colored background or foreground.
Example: `Span::styled("[P0]", Style::default().fg(theme.priority_p0))`

Adjust padding calculations to account for the badge width when priority is present.
  </action>
  <verify>cargo build passes; cargo run shows priority indicators</verify>
  <done>Todos with priority display colored badge in TUI</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build` succeeds without errors
- [ ] `cargo test` passes all tests
- [ ] `cargo clippy` has no warnings
- [ ] P0 todos show red [P0] badge
- [ ] P1 todos show yellow [P1] badge
- [ ] P2 todos show blue [P2] badge
- [ ] Todos without priority display normally (no badge)
- [ ] Existing state colors (checked=gray, question=yellow, etc.) still work
</verification>

<success_criteria>

- All tasks completed
- Priority is visually indicated in the todo list
- Colors are distinct and readable
- No visual regression for non-priority items
</success_criteria>

<output>
After completion, create `.planning/phases/03-todo-priority-system/03-03-SUMMARY.md`
</output>
