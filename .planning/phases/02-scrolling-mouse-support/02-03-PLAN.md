---
phase: 02-scrolling-mouse-support
plan: 03
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [src/ui/components/todo_list.rs, src/ui/components/status_bar.rs]
autonomous: true

must_haves:
  truths:
    - "User can see scroll position indicator when list is scrolled"
    - "Scroll position shows current range (e.g., '5-25 of 50')"
  artifacts:
    - path: "src/ui/components/status_bar.rs"
      provides: "Scroll position display"
      contains: "offset"
  key_links:
    - from: "src/ui/components/status_bar.rs"
      to: "src/app/state.rs"
      via: "reads list_state.offset and todo count"
      pattern: "list_state"
---

<objective>
Add scroll position indicator to show user where they are in the list.

Purpose: Provide visual feedback about scroll position and list size.
Output: Status bar or title bar shows scroll position when scrolled.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-scrolling-mouse-support/02-01-SUMMARY.md

@src/ui/components/todo_list.rs
@src/ui/components/status_bar.rs
@src/app/state.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add scroll position to todo list title</name>
  <files>src/ui/components/todo_list.rs</files>
  <action>
    1. In the render function, after building the items list, calculate scroll info:
       - `total_visible_items`: count of items not in hidden_indices
       - `scroll_offset`: `state.list_state.offset()`
       - `viewport_height`: `area.height.saturating_sub(2)` (minus borders)

    2. Build a scroll indicator string when scrolled (offset > 0 or total > viewport):
       ```rust
       let scroll_info = if total_visible_items > viewport_height as usize {
           let end_idx = (scroll_offset + viewport_height as usize).min(total_visible_items);
           format!(" [{}-{}/{}]", scroll_offset + 1, end_idx, total_visible_items)
       } else {
           String::new()
       };
       ```

    3. Append to the title:
       ```rust
       let title = format!(
           " Todo List - {}{}{} ",
           state.viewing_date.format("%B %d, %Y"),
           title_suffix,
           scroll_info
       );
       ```

    This shows "[1-20/50]" style indicator in the title when scrolled.

    NOTE: Only show when list is actually scrollable (total > viewport height).
  </action>
  <verify>cargo build --release passes; scroll indicator appears in title when list is scrolled</verify>
  <done>Todo list title shows scroll position when scrolled</done>
</task>

<task type="auto">
  <name>Task 2: Add helper method for visible item count</name>
  <files>src/app/state.rs</files>
  <action>
    1. Add a method to AppState:
       ```rust
       pub fn visible_item_count(&self) -> usize {
           let hidden = self.todo_list.build_hidden_indices();
           self.todo_list.items.len() - hidden.len()
       }
       ```

    2. This centralizes the visible item counting logic for use by both:
       - sync_list_state (from 02-01)
       - scroll indicator display (this plan)

    NOTE: This is a simple helper that deduplicates the hidden index calculation.
  </action>
  <verify>cargo build --release passes</verify>
  <done>AppState has visible_item_count() helper method</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --release` succeeds without errors
- [ ] `cargo clippy` passes with no warnings
- [ ] Manual test: With few items (less than viewport), no scroll indicator shown
- [ ] Manual test: With many items, scroll indicator shows in title
- [ ] Manual test: Scroll down - indicator updates (e.g., [5-25/50])
- [ ] Manual test: Scroll to bottom - indicator shows correct range
</verification>

<success_criteria>
- All tasks completed
- Scroll position indicator shows in title when list is scrollable
- Indicator updates correctly as user scrolls
- No indicator shown when list fits in viewport
</success_criteria>

<output>
After completion, create `.planning/phases/02-scrolling-mouse-support/02-03-SUMMARY.md`
</output>
