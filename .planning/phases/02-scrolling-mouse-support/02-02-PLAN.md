---
phase: 02-scrolling-mouse-support
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified: [src/app/event.rs]
autonomous: true

must_haves:
  truths:
    - "Mouse wheel scrolls the todo list up/down"
    - "Mouse clicks select correct item accounting for scroll offset"
  artifacts:
    - path: "src/app/event.rs"
      provides: "Mouse scroll wheel handling"
      contains: "ScrollUp"
  key_links:
    - from: "src/app/event.rs"
      to: "src/app/state.rs"
      via: "list_state.offset adjustment"
      pattern: "list_state"
---

<objective>
Add mouse scroll wheel support and fix click-to-item mapping to account for scroll offset.

Purpose: Enable intuitive mouse-based scrolling and ensure clicks select the correct item regardless of scroll position.
Output: Mouse wheel scrolls list; clicks work correctly at any scroll position.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-scrolling-mouse-support/02-01-SUMMARY.md

@src/app/event.rs
@src/app/state.rs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Handle mouse scroll wheel events</name>
  <files>src/app/event.rs</files>
  <action>
    1. In `handle_mouse_event`, add match arms for `MouseEventKind::ScrollUp` and `MouseEventKind::ScrollDown`
    2. For ScrollUp: Move cursor up by 3 items (or configurable scroll_amount), call `state.move_cursor_up()` 3 times, or implement `state.scroll_up(amount)` helper
    3. For ScrollDown: Move cursor down by 3 items similarly
    4. Alternative approach: Instead of moving cursor, adjust `state.list_state.offset` directly for "scroll without moving cursor" behavior - but this can desync cursor from view, so prefer moving cursor

    The simplest implementation is to treat scroll as repeated cursor movement:
    ```rust
    MouseEventKind::ScrollUp => {
        for _ in 0..3 {
            state.move_cursor_up();
        }
    }
    MouseEventKind::ScrollDown => {
        for _ in 0..3 {
            state.move_cursor_down();
        }
    }
    ```

    This keeps cursor and scroll in sync and reuses existing navigation logic.

    NOTE: Remove the early return for readonly mode for scroll events - scrolling should work when viewing archived dates.
  </action>
  <verify>cargo build --release passes; mouse wheel scrolls the todo list</verify>
  <done>Mouse scroll wheel moves cursor and scrolls the view</done>
</task>

<task type="auto">
  <name>Task 2: Fix click-to-item mapping with scroll offset</name>
  <files>src/app/event.rs</files>
  <action>
    1. In `map_click_to_item`, the current logic calculates `visual_row` from clicked_row
    2. With ListState scrolling, we need to account for the scroll offset
    3. Get the scroll offset from `state.list_state.offset()` (returns Option<usize>)
    4. Add the offset to visual_row when mapping to item index:
       ```rust
       let scroll_offset = state.list_state.offset();
       let visual_row = (clicked_row - list_start_row) + scroll_offset;
       ```
    5. The rest of the mapping logic (iterating visible items) should work as-is

    NOTE: `list_state.offset()` returns how many items are scrolled past the top of the viewport. So if offset=5, the 6th visible item is at visual row 0.

    IMPORTANT: Test edge cases:
    - Clicking when not scrolled (offset=0)
    - Clicking after scrolling down
    - Clicking on items with descriptions (multi-line)
  </action>
  <verify>cargo build --release passes; clicking items works correctly at any scroll position</verify>
  <done>Mouse clicks select correct item regardless of scroll position</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `cargo build --release` succeeds without errors
- [ ] `cargo clippy` passes with no warnings
- [ ] `cargo test` passes (existing tests)
- [ ] Manual test: Mouse wheel scrolls list up/down
- [ ] Manual test: Scroll down, then click item - correct item selected
- [ ] Manual test: Click fold icon after scrolling - correct item toggles
- [ ] Manual test: Click checkbox after scrolling - correct item toggles state
- [ ] Manual test: Scrolling works on archived (readonly) dates
</verification>

<success_criteria>
- All tasks completed
- Mouse scroll wheel scrolls the list smoothly
- Clicking items works correctly at any scroll position
- No regressions in existing mouse functionality
</success_criteria>

<output>
After completion, create `.planning/phases/02-scrolling-mouse-support/02-02-SUMMARY.md`
</output>
