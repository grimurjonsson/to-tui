---
phase: 15-migration
plan: 02
type: execute
wave: 2
depends_on: ["15-01"]
# NOTE: depends_on means 15-01 CODE must be committed (jira-claude crate exists).
# This does NOT require 15-01 RELEASE to be published (marketplace.toml URLs populated).
# Task 0 verifies local crate existence, not remote release availability.
files_modified:
  - src/plugin/mod.rs
  - src/plugin/generators/mod.rs  # To be deleted
  - src/plugin/generators/jira_claude.rs  # To be deleted
  - src/plugin/loader.rs  # Task 1.5: Add version field to LoadedPlugin
autonomous: true

must_haves:
  truths:
    - "Built-in Jira generator code no longer exists in binary"
    - "LoadedPlugin struct includes version field from plugin manifest"
    - "PluginRegistry returns empty list (no built-in generators)"
  artifacts:
    - path: "src/plugin/mod.rs"
      provides: "Plugin registry without built-in generators"
      # generators module removed
    - path: "src/plugin/loader.rs"
      provides: "LoadedPlugin with version field"
      contains: "pub version: String"
  key_links:
    - from: "src/plugin/loader.rs"
      to: "plugin.toml manifest"
      via: "Version extraction during load"
      pattern: "version"
---

<objective>
Remove the built-in Jira generator and add version field to LoadedPlugin.

Purpose: Clean up legacy generator code now that jira-claude exists as an external plugin, and prepare LoadedPlugin for UI display.

Output: Binary no longer contains built-in Jira generator; LoadedPlugin includes version from manifest.
</objective>

<execution_context>
@/Users/gimmi/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gimmi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-migration/15-CONTEXT.md
@.planning/phases/15-migration/15-RESEARCH.md

## Reference: Current Plugin State
@src/plugin/mod.rs
@src/plugin/loader.rs
</context>

<tasks>

<task type="auto">
  <name>Task 0: Verify 15-01 CODE completion (jira-claude crate exists)</name>
  <files>
    (external verification only)
  </files>
  <action>
    Before removing built-in Jira generator code, verify the jira-claude crate CODE exists locally.

    IMPORTANT: This verifies CODE completion from 15-01, NOT release completion. The marketplace.toml
    only gets populated AFTER a release tag is pushed (post-CI workflow). We can proceed with 15-02
    once 15-01 code is committed, without waiting for the release workflow.

    ```bash
    # Verify jira-claude crate exists locally (CODE completion)
    ls ~/Documents/Sources/rust/to-tui-plugins/jira-claude/src/lib.rs
    ls ~/Documents/Sources/rust/to-tui-plugins/jira-claude/Cargo.toml
    ls ~/Documents/Sources/rust/to-tui-plugins/jira-claude/plugin.toml
    ```

    Expected: All three files exist, confirming the plugin crate was created in 15-01.

    If the files don't exist, wait for 15-01 to complete its code tasks (Tasks 1-3).

    NOTE: marketplace.toml download URLs will only be populated after the FIRST release tag
    (e.g., jira-claude-v0.1.0) is pushed to the to-tui-plugins repo. This plan does NOT
    depend on that release step - only on the code existing.
  </action>
  <verify>
    All three files exist:
    - ~/Documents/Sources/rust/to-tui-plugins/jira-claude/src/lib.rs
    - ~/Documents/Sources/rust/to-tui-plugins/jira-claude/Cargo.toml
    - ~/Documents/Sources/rust/to-tui-plugins/jira-claude/plugin.toml
  </verify>
  <done>
    jira-claude crate CODE verified to exist (15-01 code committed), safe to remove built-in generator
  </done>
</task>

<task type="auto">
  <name>Task 1: Remove built-in Jira generator</name>
  <files>
    src/plugin/mod.rs
    src/plugin/generators/mod.rs
    src/plugin/generators/jira_claude.rs
    src/plugin/subprocess.rs
  </files>
  <action>
    1. Delete the entire generators directory:
       - rm src/plugin/generators/mod.rs
       - rm src/plugin/generators/jira_claude.rs

    2. Modify src/plugin/mod.rs:
       - Remove `pub mod generators;` line
       - Remove TodoGenerator trait (no longer needed - use Plugin trait from interface)
       - Keep PluginRegistry but make it empty (no built-in generators)
       - Update PluginRegistry::new() to NOT call register_builtin_generators()

       The PluginRegistry struct remains for backwards compatibility during transition,
       but its list() method now returns an empty Vec since there are no built-in generators.

       Updated mod.rs should:
       ```rust
       pub mod actions;
       pub mod command_executor;
       pub mod config;
       pub mod ffi_convert;
       // generators module REMOVED
       pub mod hooks;
       pub mod host_impl;
       pub mod installer;
       pub mod loader;
       pub mod manager;
       pub mod manifest;
       pub mod marketplace;
       pub mod subprocess;  // Keep - may be used by plugins

       // ... exports unchanged except GeneratorInfo removed

       // Remove TodoGenerator trait entirely

       // PluginRegistry now empty (legacy)
       pub struct PluginRegistry;

       impl PluginRegistry {
           pub fn new() -> Self { Self }
           pub fn list(&self) -> Vec<GeneratorInfo> { Vec::new() }
           pub fn get(&self, _name: &str) -> Option<&dyn TodoGenerator> { None }
       }

       // GeneratorInfo kept for compatibility but never used
       #[derive(Debug, Clone)]
       pub struct GeneratorInfo {
           pub name: String,
           pub description: String,
           pub available: bool,
           pub unavailable_reason: Option<String>,
       }
       ```

    3. Keep src/plugin/subprocess.rs - it provides utility functions that external plugins might need patterns from, and Command spawning is done directly by plugins.
  </action>
  <verify>
    ```bash
    cd /Users/gimmi/Documents/Sources/rust/to-tui
    cargo check 2>&1 | head -50
    ```
  </verify>
  <done>
    Generators module removed, PluginRegistry returns empty list, code compiles
  </done>
</task>

<task type="auto">
  <name>Task 1.5: Add version field to LoadedPlugin</name>
  <files>
    src/plugin/loader.rs
  </files>
  <action>
    Add a `version` field to LoadedPlugin struct so the UI can display plugin versions.

    1. Update LoadedPlugin struct in src/plugin/loader.rs:
       ```rust
       pub struct LoadedPlugin {
           pub plugin: Plugin_TO<'static, RBox<()>>,
           pub name: String,
           pub version: String,  // ADD THIS FIELD
           pub session_disabled: bool,
       }
       ```

    2. Update the load_plugin() function to extract version from the plugin manifest:
       - Read plugin.toml from the plugin directory
       - Parse the [plugin] section to get `version` field
       - Store in LoadedPlugin.version
       - Fallback to "unknown" if version cannot be determined

       Example extraction:
       ```rust
       // In load_plugin(), after loading the manifest
       let version = manifest
           .plugin
           .as_ref()
           .and_then(|p| p.version.clone())
           .unwrap_or_else(|| "unknown".to_string());
       ```
  </action>
  <verify>
    ```bash
    grep -n 'pub version: String' src/plugin/loader.rs
    # Expected: line in LoadedPlugin struct with version field
    cargo check 2>&1 | head -20
    ```
  </verify>
  <done>
    LoadedPlugin struct has version field populated from plugin manifest
  </done>
</task>

</tasks>

<verification>
1. Built-in generators removed: `grep -r "JiraClaudeGenerator" src/` returns no results
2. Generators module removed: `ls src/plugin/generators/` fails (directory deleted)
3. Code compiles: `cargo check` passes
4. Tests pass: `cargo test`
5. LoadedPlugin has version: `grep "pub version: String" src/plugin/loader.rs` returns match
</verification>

<success_criteria>
- No built-in Jira generator code remains in binary
- src/plugin/generators/ directory deleted
- LoadedPlugin struct includes version field populated from manifest
- PluginRegistry.list() returns empty Vec
</success_criteria>

<output>
After completion, create `.planning/phases/15-migration/15-02-SUMMARY.md`
</output>
